<div style="text-align: right;">
    @if (user?.credentials?.personal?.usuarios?.agregar) {
    <button mat-flat-button color="primary" (click)="openDialog(null)">
      + Agregar usuario
    </button>
    }
</div>
<br>
@if (user?.credentials?.personal?.usuarios?.ver_tbl) {
  <mat-card class="form-card">
    <div class="table-wrapper mat-elevation-z8" style="text-align-last: center">
      <table mat-table [dataSource]="dataSource" class="mat-elevation-z8">

        <!-- Columnas -->
        <ng-container matColumnDef="name">
          <th mat-header-cell *matHeaderCellDef> Nombre </th>
          <td mat-cell *matCellDef="let element"> {{element.name}} {{element.lastname}} </td>
        </ng-container>

        <ng-container matColumnDef="username">
          <th mat-header-cell *matHeaderCellDef> Username </th>
          <td mat-cell *matCellDef="let element"> {{element.username}} </td>
        </ng-container>

        <ng-container matColumnDef="role">
          <th mat-header-cell *matHeaderCellDef> Rol </th>
          <td mat-cell *matCellDef="let element"> {{element.role}} </td>
        </ng-container>

        <ng-container matColumnDef="sucursal">
          <th mat-header-cell *matHeaderCellDef> Sucursales </th>
          <td mat-cell *matCellDef="let element"> {{element.sucursal?.name}} </td>
        </ng-container>

        <ng-container matColumnDef="zone">
          <th mat-header-cell *matHeaderCellDef> Zona </th>
          <td mat-cell *matCellDef="let element"> {{element.zona?.name}} </td>
        </ng-container>

       <ng-container matColumnDef="actions">
        <th mat-header-cell *matHeaderCellDef style="width: 100px; min-width: 100px; max-width: 100px; text-align: center;"> Acciones </th>
        <td mat-cell *matCellDef="let element" style="width: 100px; min-width: 100px; max-width: 100px; text-align: center;">
          @if (checkRoles(element)) {
            <div style="display: flex; align-items: center; justify-content: center; gap: 5px;">
              @if (user?.credentials?.personal?.usuarios?.editar) {
                <button mat-icon-button (click)="openDialog(element)" matTooltip="Editar">
                  <mat-icon  class="pointer" color="primary">edit</mat-icon>
                </button>
              }
              @if (user?.credentials?.personal?.usuarios?.eliminar) {
                <button mat-icon-button (click)="removeUser(element._id)" matTooltip="Eliminar">
                  <mat-icon  class="pointer" color="warn">delete</mat-icon>
                </button>
              }
            </div>
          }
        </td>
      </ng-container>


        <!-- Filas -->
      <tr mat-header-row *matHeaderRowDef="['filter1', 'filter2', 'filter3', 'filter4', 'filter5', 'filter6']; sticky: true"></tr>
      <tr mat-header-row *matHeaderRowDef="displayedColumns; sticky: true"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>

        <!-- Filtros -->
        <ng-container matColumnDef="filter1">
          <th mat-header-cell *matHeaderCellDef>
            <mat-form-field class="filter-search" appearance="outline">
              <mat-icon matPrefix>search</mat-icon>
              <input matInput placeholder="Filtrar por nombre..." (keyup)="updateFilters()" [(ngModel)]="name">
            </mat-form-field>
          </th>
        </ng-container>

        <ng-container matColumnDef="filter2">
          <th mat-header-cell *matHeaderCellDef>
            <mat-form-field class="filter-search" appearance="outline">
              <mat-icon matPrefix>search</mat-icon>
              <input matInput placeholder="Filtrar por username..." (keyup)="updateFilters()" [(ngModel)]="username">
            </mat-form-field>
          </th>
        </ng-container>

        <ng-container matColumnDef="filter3">
          <th mat-header-cell *matHeaderCellDef>
            <mat-form-field class="filter-search" appearance="outline">
              <mat-icon matPrefix>search</mat-icon>
              <input matInput placeholder="Filtrar por rol..." autocomplete="off" (keyup)="updateFilters()" [(ngModel)]="role">
            </mat-form-field>
          </th>
        </ng-container>

        <ng-container matColumnDef="filter4">
          <th mat-header-cell *matHeaderCellDef>
            <mat-form-field class="filter-search" appearance="outline">
              <mat-icon matPrefix>search</mat-icon>
              <input matInput placeholder="Filtrar por sucursal..." autocomplete="off" (keyup)="updateFilters()" [(ngModel)]="sucursal">
            </mat-form-field>
          </th>
        </ng-container>

        <ng-container matColumnDef="filter5">
          <th mat-header-cell *matHeaderCellDef>
            <mat-form-field class="filter-search" appearance="outline">
              <mat-icon matPrefix>search</mat-icon>
              <input matInput placeholder="Filtrar por zona..." autocomplete="off" (keyup)="updateFilters()" [(ngModel)]="zona">
            </mat-form-field>
          </th>
        </ng-container>

        <ng-container matColumnDef="filter6">
          <th mat-header-cell *matHeaderCellDef></th>
        </ng-container>
      </table>
    </div>

    <mat-paginator #paginator [pageSizeOptions]="[10, 20, 30, 100]" showFirstLastButtons class="mat-elevation-z8 w-100"></mat-paginator>
  </mat-card>
}
